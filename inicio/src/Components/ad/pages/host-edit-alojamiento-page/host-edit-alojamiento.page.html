<ad-top-bar-user></ad-top-bar-user>

<div class="edit-wrap" *ngIf="!loading; else cargando">
  <h1 class="title-page">Editar alojamiento</h1>

  <!-- ÚNICO FORM -->
  <form [formGroup]="form" (ngSubmit)="guardar()" class="form-card">
    <!-- datos -->
    <div class="grid">
      <div class="field">
        <label>Título</label>
        <input type="text" formControlName="titulo" />
      </div>
      <div class="field">
        <label>Ciudad</label>
        <input type="text" formControlName="ciudad" />
      </div>
      <div class="field full">
        <label>Dirección</label>
        <input type="text" formControlName="direccion" />
      </div>
      <div class="field">
        <label>Precio por noche</label>
        <input type="number" formControlName="precioPorNoche" />
      </div>
      <div class="field">
        <label>Capacidad máxima</label>
        <input type="number" formControlName="capacidadMaxima" min="1" />
      </div>
      <div class="field">
        <label>Tipo</label>
        <select formControlName="tipoAlojamiento">
          <option value="CASA">Casa</option>
          <option value="APARTAMENTO">Apartamento</option>
          <option value="FINCA">Finca</option>
          <option value="OTRO">Otro</option>
        </select>
      </div>
      <div class="field full">
        <label>Descripción</label>
        <textarea rows="4" formControlName="descripcion"></textarea>
      </div>
    </div>

    <!-- servicios -->
    <div class="field">
      <label>Servicios</label>
      <div class="chips">
        <button
          type="button"
          class="chip"
          *ngFor="let s of serviciosDisponibles"
          [class.active]="serviciosSeleccionados.has(s)"
          (click)="toggleServicio(s)"
        >
          {{ s }}
        </button>
      </div>
    </div>

    <!-- imágenes -->
    <div class="field">
      <label>Imágenes</label>

      <div class="imgs-row">
        <div class="img-item" *ngFor="let img of imagenes; let i = index">
          <img [src]="img" alt="img" />
          <button type="button" class="img-remove" (click)="eliminarImagen(i)">×</button>
        </div>

        <label class="img-add" (click)="abrirFile()">
          Agregar imagen
          <input
            #fileInput
            type="file"
            accept="image/*"
            multiple
            hidden
            (change)="onFileSelected($event)"
          />
        </label>
      </div>

      <p class="muted" *ngIf="!imagenes.length">No hay imágenes asociadas.</p>
    </div>

    <div class="actions">
      <button type="submit" class="btn-primary">Guardar cambios</button>
      <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
    </div>
  </form>
</div>

<ng-template #cargando>
  <div class="loading">Cargando alojamiento…</div>
</ng-template>
